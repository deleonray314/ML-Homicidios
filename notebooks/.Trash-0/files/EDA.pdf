{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "2d1a8f42",
   "metadata": {},
   "source": [
    "# An√°lisis Exploratorio de Datos"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b4c98bba",
   "metadata": {},
   "source": [
    "*¬øC√≥mo se pueden predecir los patrones temporales y geogr√°ficos de homicidios en Colombia utilizando datos hist√≥ricos de la API de Datos Abiertos y t√©cnicas de Machine Learning?*"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d3513f8d",
   "metadata": {},
   "source": [
    "## Descripci√≥n de variables \n",
    "\n",
    "* homicidio_key: Inidentificador √∫nico de cada hecho\n",
    "* cod_depto: Llave secundaria que conecta con la dimensi√≥n departamento\n",
    "* cod_mpio: Llave secundaria que conecta con la dimensi√≥n municipio\n",
    "* sexo_key: Llave secundaria que conecta con la dimensi√≥n sexo\n",
    "* fecha_hecho: Fecha en que ocurri√≥ el hecho\n",
    "* Cantidad: Cantidad de victimas resgistradas en un mismo hecho\n",
    "\n",
    "* source_id: Identificador √∫nico de la fuente de datos\n",
    "* loaded_at: Fecha en que se carg√≥ el hecho\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "7a3bd96f",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Importar librer√≠as\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "from sqlalchemy import create_engine\n",
    "from dotenv import load_dotenv\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "import sys\n",
    "import os\n",
    "\n",
    "# Opciones de visualiazacion de tablas \n",
    "pd.options.display.max_columns = None\n",
    "pd.options.display.max_rows = None"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "5c4e9d87",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Python: 3.12.12 (main, Dec  8 2025, 23:38:42) [GCC 14.2.0]\n",
      "Ejecutando en: /usr/local\n",
      "\n",
      "‚úÖ Conexi√≥n exitosa!\n",
      "üìä Base de datos: homicidios_dw\n",
      "üë§ Usuario: dw_user\n"
     ]
    }
   ],
   "source": [
    "# Comprobaci√≥n de la conexion al contenedor\n",
    "print(f'Python: {sys.version}')\n",
    "print(f'Ejecutando en: {sys.prefix}\\n')\n",
    "\n",
    "\n",
    "# Conexi√≥n a la base de datos\n",
    "load_dotenv('/app/.env')\n",
    "\n",
    "DW_USER = os.getenv('DW_USER')\n",
    "DW_PASSWORD = os.getenv('DW_PASSWORD')\n",
    "DW_HOST = 'datawarehouse'\n",
    "DW_PORT = '5432'\n",
    "DW_DB = os.getenv('DW_DB')\n",
    "\n",
    "connection_string = f\"postgresql://{DW_USER}:{DW_PASSWORD}@{DW_HOST}:{DW_PORT}/{DW_DB}\"\n",
    "engine = create_engine(connection_string)\n",
    "\n",
    "# Probar conexi√≥n\n",
    "with engine.connect() as conn:\n",
    "    result = pd.read_sql(\"SELECT current_database(), current_user;\", conn)\n",
    "    print(\"‚úÖ Conexi√≥n exitosa!\")\n",
    "    print(f\"üìä Base de datos: {result.iloc[0, 0]}\")\n",
    "    print(f\"üë§ Usuario: {result.iloc[0, 1]}\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "51205541",
   "metadata": {},
   "source": [
    "### Obtenci√≥n de los Metadatos"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "158a683f",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "üìã Tablas en el Data Warehouse:\n",
      "\n",
      "      table_name  num_columnas  tama√±o\n",
      "dim_departamento             4   40 kB\n",
      "       dim_fecha            12 1280 kB\n",
      "   dim_municipio             6  408 kB\n",
      "        dim_sexo             2   56 kB\n",
      "         etl_log            10   48 kB\n",
      " fact_homicidios             9   59 MB\n",
      "\n",
      "üìä Total de tablas: 6\n"
     ]
    }
   ],
   "source": [
    "# Obtener metadatos de las tablas (sin cargar datos)\n",
    "query_tables = \"\"\"\n",
    "SELECT \n",
    "    t.table_name,\n",
    "    COUNT(c.column_name) as num_columnas,\n",
    "    pg_size_pretty(pg_total_relation_size(quote_ident(t.table_name)::regclass)) as tama√±o\n",
    "FROM information_schema.tables t\n",
    "LEFT JOIN information_schema.columns c \n",
    "    ON t.table_name = c.table_name \n",
    "    AND t.table_schema = c.table_schema\n",
    "WHERE t.table_schema = 'public'\n",
    "    AND t.table_type = 'BASE TABLE'\n",
    "GROUP BY t.table_name\n",
    "ORDER BY t.table_name;\n",
    "\"\"\"\n",
    "\n",
    "df_tables = pd.read_sql(query_tables, engine)\n",
    "print(\"üìã Tablas en el Data Warehouse:\\n\")\n",
    "print(df_tables.to_string(index=False))\n",
    "print(f\"\\nüìä Total de tablas: {len(df_tables)}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "71cd73eb",
   "metadata": {},
   "outputs": [],
   "source": [
    "df_fact_homicidios = pd.read_sql_query('''\n",
    "SELECT\n",
    "    homicidio_key,\n",
    "    cod_depto,\n",
    "    cod_mpio,\n",
    "    sexo_key,\n",
    "    cantidad as total_homicidios,\n",
    "    zona\n",
    "FROM\n",
    "    fact_homicidios\n",
    "    \n",
    "'''\n",
    ",  engine)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "a8b62e8f-d95d-41e0-8e35-276b46f96ecd",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>homicidio_key</th>\n",
       "      <th>cod_depto</th>\n",
       "      <th>cod_mpio</th>\n",
       "      <th>sexo_key</th>\n",
       "      <th>total_homicidios</th>\n",
       "      <th>zona</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>11</td>\n",
       "      <td>11001</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>URBANA</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>11</td>\n",
       "      <td>11001</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>URBANA</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>11</td>\n",
       "      <td>11001</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>URBANA</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>11</td>\n",
       "      <td>11001</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>URBANA</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>11</td>\n",
       "      <td>11001</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>URBANA</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   homicidio_key  cod_depto  cod_mpio  sexo_key  total_homicidios    zona\n",
       "0              1         11     11001         5                 1  URBANA\n",
       "1              2         11     11001         5                 1  URBANA\n",
       "2              3         11     11001         5                 1  URBANA\n",
       "3              4         11     11001         5                 1  URBANA\n",
       "4              5         11     11001         5                 1  URBANA"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_fact_homicidios.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "80a9a745",
   "metadata": {},
   "source": [
    "## Obtener una vision general de los datos \n",
    "### Lectura de las tablas"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "1a6cc492",
   "metadata": {},
   "outputs": [],
   "source": [
    "df = pd.read_sql_query('''\n",
    "SELECT\n",
    "    f.homicidio_key,\n",
    "    d_f.fecha,\n",
    "    d_f.nombre_mes,\n",
    "    d_f.nombre_dia_semana,\n",
    "    d_f.es_fin_semana,\n",
    "    d_f.es_festivo,\n",
    "    d_m.nom_mpio,\n",
    "    d_m.tipo AS tipo_municipio,\n",
    "    d_m.latitud AS latitud,\n",
    "    d_m.longitud AS longitud,\n",
    "    f.zona,\n",
    "    f.cantidad as total_homicidios\n",
    "FROM fact_homicidios f\n",
    "INNER JOIN dim_fecha d_f \n",
    "    ON f.fecha_key = d_f.fecha_key\n",
    "INNER JOIN dim_municipio d_m \n",
    "    ON f.cod_mpio = d_m.cod_mpio\n",
    "''',\n",
    "engine)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "510263cd",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 333267 entries, 0 to 333266\n",
      "Data columns (total 12 columns):\n",
      " #   Column             Non-Null Count   Dtype  \n",
      "---  ------             --------------   -----  \n",
      " 0   homicidio_key      333267 non-null  int64  \n",
      " 1   fecha              333267 non-null  object \n",
      " 2   nombre_mes         333267 non-null  object \n",
      " 3   nombre_dia_semana  333267 non-null  object \n",
      " 4   es_fin_semana      333267 non-null  bool   \n",
      " 5   es_festivo         333267 non-null  bool   \n",
      " 6   nom_mpio           333267 non-null  object \n",
      " 7   tipo_municipio     333267 non-null  object \n",
      " 8   latitud            333267 non-null  float64\n",
      " 9   longitud           333267 non-null  float64\n",
      " 10  zona               333267 non-null  object \n",
      " 11  total_homicidios   333267 non-null  int64  \n",
      "dtypes: bool(2), float64(2), int64(2), object(6)\n",
      "memory usage: 26.1+ MB\n"
     ]
    }
   ],
   "source": [
    "# informaci√≥n sobre el conjunto de datos enrriquecido con las dimensiones \n",
    "df.info()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "a84c2763",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>homicidio_key</th>\n",
       "      <th>fecha</th>\n",
       "      <th>nombre_mes</th>\n",
       "      <th>nombre_dia_semana</th>\n",
       "      <th>es_fin_semana</th>\n",
       "      <th>es_festivo</th>\n",
       "      <th>nom_mpio</th>\n",
       "      <th>tipo_municipio</th>\n",
       "      <th>latitud</th>\n",
       "      <th>longitud</th>\n",
       "      <th>zona</th>\n",
       "      <th>total_homicidios</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>219165</th>\n",
       "      <td>219166</td>\n",
       "      <td>2017-02-15</td>\n",
       "      <td>Febrero</td>\n",
       "      <td>Mi√©rcoles</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>SANTA F√â DE ANTIOQUIA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>6.535712</td>\n",
       "      <td>-75.904267</td>\n",
       "      <td>RURAL</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>149149</th>\n",
       "      <td>149150</td>\n",
       "      <td>2011-12-12</td>\n",
       "      <td>Diciembre</td>\n",
       "      <td>Lunes</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>ARGELIA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>5.708115</td>\n",
       "      <td>-75.094698</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>111130</th>\n",
       "      <td>111131</td>\n",
       "      <td>2009-06-15</td>\n",
       "      <td>Junio</td>\n",
       "      <td>Lunes</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>POLICARPA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>1.735354</td>\n",
       "      <td>-77.481344</td>\n",
       "      <td>RURAL</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>165202</th>\n",
       "      <td>165203</td>\n",
       "      <td>2012-12-21</td>\n",
       "      <td>Diciembre</td>\n",
       "      <td>Viernes</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>SAN MART√çN</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>3.515861</td>\n",
       "      <td>-72.656727</td>\n",
       "      <td>RURAL</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>118576</th>\n",
       "      <td>118577</td>\n",
       "      <td>2009-12-05</td>\n",
       "      <td>Diciembre</td>\n",
       "      <td>S√°bado</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>PITAL</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>2.259602</td>\n",
       "      <td>-75.831952</td>\n",
       "      <td>RURAL</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>219106</th>\n",
       "      <td>219107</td>\n",
       "      <td>2017-02-13</td>\n",
       "      <td>Febrero</td>\n",
       "      <td>Lunes</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>BARRANQUILLA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>10.981521</td>\n",
       "      <td>-74.827715</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>109510</th>\n",
       "      <td>109511</td>\n",
       "      <td>2009-05-06</td>\n",
       "      <td>Mayo</td>\n",
       "      <td>Mi√©rcoles</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>SAN ANDR√âS DE TUMACO</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>1.574551</td>\n",
       "      <td>-78.615410</td>\n",
       "      <td>RURAL</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>298735</th>\n",
       "      <td>298736</td>\n",
       "      <td>2023-05-17</td>\n",
       "      <td>Mayo</td>\n",
       "      <td>Mi√©rcoles</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>SAN JOS√â DE TOLUVIEJO</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>9.490298</td>\n",
       "      <td>-75.444511</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>250355</th>\n",
       "      <td>250356</td>\n",
       "      <td>2019-08-31</td>\n",
       "      <td>Agosto</td>\n",
       "      <td>S√°bado</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>BARRANQUILLA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>10.981521</td>\n",
       "      <td>-74.827715</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7720</th>\n",
       "      <td>7721</td>\n",
       "      <td>2003-04-26</td>\n",
       "      <td>Abril</td>\n",
       "      <td>S√°bado</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>BARRANQUILLA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>10.981521</td>\n",
       "      <td>-74.827715</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>129426</th>\n",
       "      <td>129427</td>\n",
       "      <td>2010-08-31</td>\n",
       "      <td>Agosto</td>\n",
       "      <td>Martes</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>DABEIBA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>6.992244</td>\n",
       "      <td>-76.314263</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>242011</th>\n",
       "      <td>242012</td>\n",
       "      <td>2018-12-29</td>\n",
       "      <td>Diciembre</td>\n",
       "      <td>S√°bado</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>BOGOT√Å, D.C.</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>4.316108</td>\n",
       "      <td>-74.181073</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>89807</th>\n",
       "      <td>89808</td>\n",
       "      <td>2008-01-05</td>\n",
       "      <td>Enero</td>\n",
       "      <td>S√°bado</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>SAN JOS√â DE C√öCUTA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>8.112042</td>\n",
       "      <td>-72.488626</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>83167</th>\n",
       "      <td>83168</td>\n",
       "      <td>2007-07-23</td>\n",
       "      <td>Julio</td>\n",
       "      <td>Lunes</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>CI√âNAGA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>10.857546</td>\n",
       "      <td>-74.025005</td>\n",
       "      <td>RURAL</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>86322</th>\n",
       "      <td>86323</td>\n",
       "      <td>2007-10-11</td>\n",
       "      <td>Octubre</td>\n",
       "      <td>Jueves</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>MONTEL√çBANO</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>7.866433</td>\n",
       "      <td>-75.875339</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>185436</th>\n",
       "      <td>185437</td>\n",
       "      <td>2014-05-19</td>\n",
       "      <td>Mayo</td>\n",
       "      <td>Lunes</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>MONTER√çA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>8.584698</td>\n",
       "      <td>-75.950551</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25708</th>\n",
       "      <td>25709</td>\n",
       "      <td>2004-02-24</td>\n",
       "      <td>Febrero</td>\n",
       "      <td>Martes</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>YOPAL</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>5.242745</td>\n",
       "      <td>-72.258029</td>\n",
       "      <td>RURAL</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>152360</th>\n",
       "      <td>152361</td>\n",
       "      <td>2012-03-01</td>\n",
       "      <td>Marzo</td>\n",
       "      <td>Jueves</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>SAN ANDR√âS DE TUMACO</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>1.574551</td>\n",
       "      <td>-78.615410</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>170061</th>\n",
       "      <td>170062</td>\n",
       "      <td>2013-04-11</td>\n",
       "      <td>Abril</td>\n",
       "      <td>Jueves</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>BOGOT√Å, D.C.</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>4.316108</td>\n",
       "      <td>-74.181073</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>223373</th>\n",
       "      <td>223374</td>\n",
       "      <td>2017-06-29</td>\n",
       "      <td>Junio</td>\n",
       "      <td>Jueves</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>BUCARAMANGA</td>\n",
       "      <td>Municipio</td>\n",
       "      <td>7.155834</td>\n",
       "      <td>-73.111570</td>\n",
       "      <td>URBANA</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        homicidio_key       fecha nombre_mes nombre_dia_semana  es_fin_semana  \\\n",
       "219165         219166  2017-02-15    Febrero         Mi√©rcoles          False   \n",
       "149149         149150  2011-12-12  Diciembre             Lunes          False   \n",
       "111130         111131  2009-06-15      Junio             Lunes          False   \n",
       "165202         165203  2012-12-21  Diciembre           Viernes          False   \n",
       "118576         118577  2009-12-05  Diciembre            S√°bado           True   \n",
       "219106         219107  2017-02-13    Febrero             Lunes          False   \n",
       "109510         109511  2009-05-06       Mayo         Mi√©rcoles          False   \n",
       "298735         298736  2023-05-17       Mayo         Mi√©rcoles          False   \n",
       "250355         250356  2019-08-31     Agosto            S√°bado           True   \n",
       "7720             7721  2003-04-26      Abril            S√°bado           True   \n",
       "129426         129427  2010-08-31     Agosto            Martes          False   \n",
       "242011         242012  2018-12-29  Diciembre            S√°bado           True   \n",
       "89807           89808  2008-01-05      Enero            S√°bado           True   \n",
       "83167           83168  2007-07-23      Julio             Lunes          False   \n",
       "86322           86323  2007-10-11    Octubre            Jueves          False   \n",
       "185436         185437  2014-05-19       Mayo             Lunes          False   \n",
       "25708           25709  2004-02-24    Febrero            Martes          False   \n",
       "152360         152361  2012-03-01      Marzo            Jueves          False   \n",
       "170061         170062  2013-04-11      Abril            Jueves          False   \n",
       "223373         223374  2017-06-29      Junio            Jueves          False   \n",
       "\n",
       "        es_festivo               nom_mpio tipo_municipio    latitud  \\\n",
       "219165       False  SANTA F√â DE ANTIOQUIA      Municipio   6.535712   \n",
       "149149       False                ARGELIA      Municipio   5.708115   \n",
       "111130       False              POLICARPA      Municipio   1.735354   \n",
       "165202       False             SAN MART√çN      Municipio   3.515861   \n",
       "118576       False                  PITAL      Municipio   2.259602   \n",
       "219106       False           BARRANQUILLA      Municipio  10.981521   \n",
       "109510       False   SAN ANDR√âS DE TUMACO      Municipio   1.574551   \n",
       "298735       False  SAN JOS√â DE TOLUVIEJO      Municipio   9.490298   \n",
       "250355       False           BARRANQUILLA      Municipio  10.981521   \n",
       "7720         False           BARRANQUILLA      Municipio  10.981521   \n",
       "129426       False                DABEIBA      Municipio   6.992244   \n",
       "242011       False           BOGOT√Å, D.C.      Municipio   4.316108   \n",
       "89807        False     SAN JOS√â DE C√öCUTA      Municipio   8.112042   \n",
       "83167        False                CI√âNAGA      Municipio  10.857546   \n",
       "86322        False            MONTEL√çBANO      Municipio   7.866433   \n",
       "185436       False               MONTER√çA      Municipio   8.584698   \n",
       "25708        False                  YOPAL      Municipio   5.242745   \n",
       "152360       False   SAN ANDR√âS DE TUMACO      Municipio   1.574551   \n",
       "170061       False           BOGOT√Å, D.C.      Municipio   4.316108   \n",
       "223373       False            BUCARAMANGA      Municipio   7.155834   \n",
       "\n",
       "         longitud    zona  total_homicidios  \n",
       "219165 -75.904267   RURAL                 1  \n",
       "149149 -75.094698  URBANA                 1  \n",
       "111130 -77.481344   RURAL                 1  \n",
       "165202 -72.656727   RURAL                 1  \n",
       "118576 -75.831952   RURAL                 1  \n",
       "219106 -74.827715  URBANA                 1  \n",
       "109510 -78.615410   RURAL                 1  \n",
       "298735 -75.444511  URBANA                 1  \n",
       "250355 -74.827715  URBANA                 1  \n",
       "7720   -74.827715  URBANA                 1  \n",
       "129426 -76.314263  URBANA                 1  \n",
       "242011 -74.181073  URBANA                 1  \n",
       "89807  -72.488626  URBANA                 1  \n",
       "83167  -74.025005   RURAL                 1  \n",
       "86322  -75.875339  URBANA                 1  \n",
       "185436 -75.950551  URBANA                 1  \n",
       "25708  -72.258029   RURAL                 1  \n",
       "152360 -78.615410  URBANA                 1  \n",
       "170061 -74.181073  URBANA                 1  \n",
       "223373 -73.111570  URBANA                 1  "
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.sample(20)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "20ce2ad2",
   "metadata": {},
   "outputs": [],
   "source": [
    "df['tipo_municipio'].unique()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c742a1b9",
   "metadata": {},
   "source": [
    "## Se define una serie de tiempo para posiblemente predecir la cantidad de homicidios en a√±os venideros. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "18f664aa",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Totales Homicidios por a√±o\n",
    "\n",
    "df_homicidios_por_anio = pd.read_sql(\n",
    "'''\n",
    "SELECT\n",
    "    f.a√±o,\n",
    "    count(homicidio_key) as hechos_registrados,\n",
    "    sum(h.cantidad) as total_victimas\n",
    "FROM fact_homicidios h\n",
    "LEFT JOIN dim_fecha f \n",
    "    ON h.fecha_key = f.fecha_key\n",
    "GROUP BY f.a√±o\n",
    "ORDER BY f.a√±o ASC;\n",
    "'''\n",
    ", engine)\n",
    "\n",
    "df_homicidios_por_anio\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6a88c5c6",
   "metadata": {},
   "outputs": [],
   "source": [
    "df_homicidios_por_anio[['hechos_registrados','total_victimas']].describe()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8ef009d1",
   "metadata": {},
   "outputs": [],
   "source": [
    "df_fact_homicidios.info()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "7bb6fe9a",
   "metadata": {},
   "outputs": [],
   "source": [
    "df_fact_homicidios['cantidad'].describe()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "db0038cb",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Homicidios por departamento\n",
    "df_homicidios_por_departamento = pd.read_sql(\"SELECT * FROM v_homicidios_por_departamento LIMIT 32;\", engine)\n",
    "df_homicidios_por_departamento.head(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "ed392c4b",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Homicidios por mes \n",
    "df_homi_por_mes = pd.read_sql(\"SELECT * FROM v_homicidios_por_mes ORDER BY a√±o DESC, mes DESC LIMIT 1000\", engine)\n",
    "df_homi_por_mes[df_homi_por_mes['a√±o'] == 2003].sort_values(by='total_victimas', ascending=False)\n"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
